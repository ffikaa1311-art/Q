<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>18th Birthday Journey</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <style>
        :root {
            --ungu: #D6BCFA;
            --ungu-tua: #9F7AEA;
            --biru: #BEE3F8;
            --biru-tua: #63B3ED;
            --putih: #FFFFFF;
            /* Warna Tiket Baru */
            --tkt-grad: linear-gradient(135deg, #9F7AEA, #63B3ED);
        }

        body {
            margin: 0; padding: 0;
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(135deg, var(--ungu), var(--putih), var(--biru));
            background-attachment: fixed;
            min-height: 100vh;
        }

        .happy-title {
            font-family: 'Fredoka One', cursive;
            font-size: 3rem;
            color: var(--ungu-tua);
            animation: pulse 2s infinite;
            margin-bottom: 10px;
        }

        .once-anim { font-family: 'Fredoka One', cursive; }

        .page {
            position: fixed; inset: 0;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 1000; padding: 20px; text-align: center;
        }

        .card {
            background: white; padding: 30px; border-radius: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            max-width: 350px; border: 2px solid var(--ungu);
        }

        .btn-main {
            background: var(--ungu-tua); color: white; border: none;
            padding: 15px 40px; border-radius: 30px; font-weight: bold;
            cursor: pointer; margin-top: 20px; 
            font-family: 'Fredoka One', cursive;
            transition: transform 0.2s, background 0.2s;
            -webkit-font-smoothing: antialiased;
        }
        .btn-main:hover { background: var(--biru-tua); transform: scale(1.02); }
        .btn-main:disabled { background: #cbd5e0; cursor: not-allowed; transform: none; }

        #main-content { display: none; padding: 80px 20px 20px; text-align: center; }
        header { position: fixed; top: 0; width: 100%; padding: 20px; display: flex; justify-content: flex-end; box-sizing: border-box; z-index: 500; }

        .grid-18 { 
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; 
            max-width: 400px; margin: 0 auto;
        }
        
        .box {
            aspect-ratio: 1/1; background: var(--putih); border-radius: 18px; 
            border: 2px solid var(--biru); display: flex; align-items: center; 
            justify-content: center; font-weight: 700; color: var(--biru-tua); 
            font-size: 1.2rem; cursor: pointer; position: relative;
        }
        .box.locked { background: #e2e8f0; color: #a0aec0; cursor: not-allowed; border-color: #cbd5e0; }
        .box.locked::after { content: 'ğŸ”’'; font-size: 0.8rem; position: absolute; top: 5px; right: 5px; }
        .box.done { border-color: var(--ungu-tua); background: #f3ebff; }

        .overlay {
            display: none; position: fixed; inset: 0;
            background: rgba(0,0,0,0.5); backdrop-filter: blur(8px);
            z-index: 2000; align-items: center; justify-content: center;
        }
        .modal-card { background: var(--putih); width: 90%; max-width: 340px; padding: 25px; border-radius: 25px; text-align: center; }

        /* --- STYLING TIKET UNGU BIRU --- */
        .ticket-slider-container { position: relative; width: 100%; overflow: hidden; margin-top: 15px; }
        .ticket-wrapper { display: flex; transition: transform 0.4s ease-in-out; width: 300%; }
        .ticket-item { width: 100%; flex-shrink: 0; padding: 10px; box-sizing: border-box; }
        
        .ticket-retro {
            background: var(--tkt-grad);
            color: white;
            padding: 20px;
            position: relative;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border-radius: 12px;
            mask-image: radial-gradient(circle at 0 50%, transparent 12px, black 13px), 
                        radial-gradient(circle at 100% 50%, transparent 12px, black 13px);
            mask-size: 100% 100%;
            box-shadow: 0 8px 15px rgba(100, 100, 255, 0.2);
        }

        .ticket-inner {
            border: 2px dashed rgba(255,255,255,0.4);
            padding: 15px;
            border-radius: 8px;
            height: 100%;
        }

        .ticket-retro h3 { font-family: 'Fredoka One', cursive; font-size: 18px; margin: 0; letter-spacing: 1px; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
        .ticket-retro p { font-size: 12px; margin: 8px 0; opacity: 0.95; font-weight: 500; }

        .btn-pakai {
            background: white; color: var(--ungu-tua); border: none;
            padding: 7px 18px; border-radius: 20px; font-weight: bold;
            font-size: 12px; cursor: pointer; margin-top: 5px;
            transition: 0.3s;
        }
        .btn-pakai:hover { background: var(--biru); color: var(--biru-tua); }

        .status-stamp {
            display: none; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            font-size: 24px; font-weight: bold; color: #ff3e3e;
            border: 4px solid #ff3e3e; padding: 5px 15px;
            border-radius: 10px; background: rgba(255,255,255,0.9); z-index: 10;
        }
        .used .ticket-retro { filter: grayscale(0.8); opacity: 0.5; }
        .used .status-stamp { display: block; }
        .used .btn-pakai { display: none; }

        .nav-tkt {
            position: absolute; top: 50%; transform: translateY(-50%);
            background: rgba(255,255,255,0.4); border: none; font-size: 20px;
            cursor: pointer; z-index: 30; color: #555; padding: 5px; border-radius: 50%;
            width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;
        }
        .prev-tkt { left: -5px; }
        .next-tkt { right: -5px; }

        /* Logic Envelope & Camera */
        .envelope-wrapper { cursor: pointer; display: flex; justify-content: center; margin-top: 15px; }
        .envelope { position: relative; width: 100px; height: 70px; background-color: var(--ungu); border-radius: 0 0 10px 10px; transition: 0.5s; }
        .envelope::before { content: ''; position: absolute; top: 0; left: 0; border-top: 40px solid var(--biru); border-left: 50px solid transparent; border-right: 50px solid transparent; border-radius: 10px 10px 0 0; transition: 0.5s; z-index: 2; }
        .envelope.open::before { transform: rotateX(180deg); transform-origin: top; }
        .letter-small { position: absolute; top: 10px; left: 5px; width: 90px; height: 50px; background: white; border-radius: 5px; transition: 0.5s; z-index: 1; opacity: 0; }
        .envelope.open .letter-small { transform: translateY(-30px); opacity: 1; }
    </style>
</head>
<body>

    <audio id="bgm" loop src="musik.mp3"></audio>

    <div id="cover-page" class="page animate__animated animate__fadeIn">
        <h1 class="happy-title">Happy 18th! ğŸ‚</h1>
        <p>A simple gift for my favorite person.</p>
        <button class="btn-main" onclick="goToRules()">Ketuk untuk Mulai âœ¨</button>
    </div>

    <div id="rules-page" class="page" style="display:none;">
        <div class="card animate__animated animate__zoomIn">
            <h2 class="once-anim" style="color:var(--ungu-tua)">Rules ğŸ“œ</h2>
            <ul style="text-align: left; font-size: 14px; line-height: 2; margin-bottom: 20px;">
                <li>âœ¨ Harus buka nomor secara urut ya!</li>
                <li>âœ¨ Tiap nomor punya rahasia sendiri.</li>
                <li>âœ¨ Selesaikan misi buat buka nomor selanjutnya.</li>
                <li>âœ¨ I hope this makes you smile!</li>
            </ul>
            <label style="display: flex; align-items: center; gap: 10px; font-size: 14px; cursor: pointer;">
                <input type="checkbox" id="ruleCheck" onchange="document.getElementById('nextBtn').disabled = !this.checked"> Saya mengerti & siap!
            </label>
            <button class="btn-main" id="nextBtn" disabled onclick="goToMain()">Lanjutkan ğŸš€</button>
        </div>
    </div>

    <header id="main-header" style="display: none;">
        <div class="music-btn" id="musicBtn" onclick="toggleMusic()">ğŸµ</div>
    </header>

    <div id="main-content">
        <h2 class="once-anim" style="color:var(--ungu-tua); margin-bottom: 20px;">18 Pintu Kejutan ğŸ</h2>
        <div class="grid-18" id="grid"></div>
        <div style="height: 50px;"></div>
    </div>

    <div id="contentModal" class="overlay">
        <div class="modal-card">
            <h1 id="mIcon"></h1>
            <div id="mBody" style="font-size: 15px; color: #4A5568; margin-bottom: 20px;"></div>
            <div id="cam-area" style="display:none;">
                <video id="video-cam" autoplay playsinline></video>
                <canvas id="photo-canvas"></canvas>
                <h2 id="timer"></h2>
                <a id="downloadLink" style="display:none;" class="btn-main">Simpan Foto ğŸ“¸</a>
            </div>
            <div id="wish-area" style="display:none;">
                <textarea id="wishInput" placeholder="Ketik doa kamu di sini..." style="width:100%; border-radius:10px; padding:10px; border:1px solid var(--ungu); font-family: inherit;"></textarea>
            </div>
            <button class="btn-main" id="modalActionBtn" onclick="processAction()">Lanjut</button>
        </div>
    </div>

    <script>
        const bgm = document.getElementById('bgm');
        let playing = false;
        let currentUnlocked = 1;
        let tktIndex = 0;

        function toggleMusic() {
            if(!playing) { bgm.play(); document.getElementById('musicBtn').innerText = "â¸ï¸"; }
            else { bgm.pause(); document.getElementById('musicBtn').innerText = "ğŸµ"; }
            playing = !playing;
        }

        function goToRules() {
            document.getElementById('cover-page').style.display = 'none';
            document.getElementById('rules-page').style.display = 'flex';
        }

        function goToMain() {
            document.getElementById('rules-page').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
            document.getElementById('main-header').style.display = 'flex';
            renderGrid();
            if(!playing) toggleMusic();
        }

        const data = {
            1: ["ğŸ•¯ï¸", "Selamat Ulang Tahun, Sayangkuuuu <br><br> <div onclick='this.innerHTML=\"ğŸ‚\"; unlockNext(1);' style='font-size:50px; cursor:pointer;'>ğŸ”¥<br>ğŸ‚</div>"],
            2: ["ğŸ’Œ", `Ada surat buat kamu di dalem amplop ini... <br>
                <div class="envelope-wrapper" onclick="handleLetterClick(this)">
                    <div class="envelope"><div class="letter-small"></div></div>
                </div>
                <div id="realLetter" style="display:none; margin-top:15px; text-align:left; background:#fff3ff; padding:10px; border-radius:10px;">
                    'Sayang, kamu itu berharga banget buat aku. Makasih ya udah lahir ke dunia ini...'
                </div>`],
            3: ["ğŸ™ï¸", "Pesan suara buat kamu: <br><a href='#' target='_blank' style='color:var(--ungu-tua); text-decoration:underline;'>Dengerin di sini</a>"],
            4: ["ğŸµ", `Lagu yang pas banget buat kamu: <br>
                <a href='https://open.spotify.com/playlist/link-playlist-kamu8' target='_blank' onclick="stepOneSpotify()" style='color:var(--ungu-tua); text-decoration:underline; font-weight:bold;'>Buka Spotify (Terpukau - Astrid)</a>
                <div id="reasonArea" style="display:none; margin-top:20px; border-top:1px dashed var(--ungu); padding-top:10px;">
                    <p><b>Kenapa aku kasih lagu ini?</b></p>
                    <p style="font-style: italic;">"Karena tiap denger lagu ini, aku selalu terpukau sama kehadiran kamu di hidupku..."</p>
                </div>`],
            5: ["ğŸŸï¸", `
                Silahkan pilih tiket makan kamu hari ini! <br>
                <div class="ticket-slider-container">
                    <button class="nav-tkt prev-tkt" onclick="moveTkt(-1)">â®</button>
                    <button class="nav-tkt next-tkt" onclick="moveTkt(1)">â¯</button>
                    <div class="ticket-wrapper" id="tktWrap">
                        <div class="ticket-item" id="tkt1"><div class="ticket-retro"><div class="ticket-inner"><h3>TIKET AEON</h3><p>Makan kenyang di AEON!</p><button class="btn-pakai" onclick="useTkt('tkt1')">Gunakan</button></div><div class="status-stamp">USED</div></div></div>
                        <div class="ticket-item" id="tkt2"><div class="ticket-retro"><div class="ticket-inner"><h3>TIKET BAKMIE</h3><p>Bakmie favorit kamu!</p><button class="btn-pakai" onclick="useTkt('tkt2')">Gunakan</button></div><div class="status-stamp">USED</div></div></div>
                        <div class="ticket-item" id="tkt3"><div class="ticket-retro"><div class="ticket-inner"><h3>TIKET BEBAS</h3><p>Pilih makan apa saja!</p><button class="btn-pakai" onclick="useTkt('tkt3')">Gunakan</button></div><div class="status-stamp">USED</div></div></div>
                    </div>
                </div>
                <p style="font-size: 11px; margin-top:10px; color:#999;">Slide untuk pilih tiket lainnya</p>
            `],
            6: ["ğŸ’ª", "Kesehatan itu penting, jangan begadang!"],
            7: ["ğŸ“–", "Kamus Fika: Kamu adalah penyemangatku!"],
            8: ["ğŸ§©", "Mini Game: Cari 3 perbedaan di foto kita? (Chat aku ya!)"],
            9: ["ğŸš€", "Sukses terus buat masa depan kamu!"],
            10: ["ğŸˆ", "Balon virtual buat kamu! ğŸˆğŸˆğŸˆ"],
            11: ["ğŸ“¸", "Slide foto: 'Ini kamu pas belum 18 tahun lho!'"],
            12: ["ğŸ¤«", "Halaman Rahasia: I Love You!"],
            13: ["ğŸŸï¸", "Kupon Unlimited: Bebas manja!"],
            14: ["ğŸ¡", "SPIN PRANK! <button onclick='this.innerText=\"ZONK! Dapet Milkita!\"; unlockNext(14);'>SPIN</button>"],
            15: ["â±ï¸", "TANTANGAN 18 DETIK! Pose jelek sekarang! <br><button id='startCamBtn' onclick='startCameraChallenge()'>Mulai Kamera</button>"],
            16: ["âœ¨", "<b>Make a Wish</b><br>Tulis harapanmu di bawah ini:"],
            17: ["ğŸ¹", "Hadiah Utama: Video Piano aku! <br><a href='#' target='_blank'>Tonton di sini</a>"],
            18: ["ğŸ“", "Call Me Now! <br><a href='tel:000000'>Klik buat telpon aku</a>"]
        };

        function moveTkt(dir) {
            const wrap = document.getElementById('tktWrap');
            tktIndex = (tktIndex + dir + 3) % 3;
            wrap.style.transform = `translateX(-${tktIndex * 33.333}%)`;
        }

        function useTkt(id) {
            if(confirm("Gunakan tiket ini sekarang?")) {
                document.getElementById(id).classList.add('used');
                localStorage.setItem(id, 'used');
            }
        }

        function stepOneSpotify() {
            document.getElementById('modalActionBtn').style.display = 'inline-block';
            document.getElementById('modalActionBtn').onclick = () => {
                document.getElementById('reasonArea').style.display = 'block';
                document.getElementById('modalActionBtn').onclick = processAction;
            };
        }

        function handleLetterClick(el) {
            el.querySelector('.envelope').classList.add('open');
            setTimeout(() => {
                document.getElementById('realLetter').style.display = 'block';
                el.style.display = 'none';
                document.getElementById('modalActionBtn').style.display = 'inline-block';
            }, 600);
        }

        function renderGrid() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            for(let i=1; i<=18; i++) {
                const b = document.createElement('div');
                b.className = `box ${i > currentUnlocked ? 'locked' : ''} ${i < currentUnlocked ? 'done' : ''}`;
                b.innerText = i;
                if(i <= currentUnlocked) b.onclick = () => openBox(i);
                grid.appendChild(b);
            }
        }

        function openBox(id) {
            const m = document.getElementById('contentModal');
            document.getElementById('mIcon').innerText = data[id][0];
            document.getElementById('mBody').innerHTML = data[id][1];
            document.getElementById('cam-area').style.display = 'none';
            document.getElementById('wish-area').style.display = 'none';
            document.getElementById('modalActionBtn').style.display = 'inline-block';
            
            if(id == 2 || id == 4 || id == 15) document.getElementById('modalActionBtn').style.display = 'none';
            if(id == 16) document.getElementById('wish-area').style.display = 'block';
            
            if(id == 5) {
                setTimeout(() => {
                    ['tkt1', 'tkt2', 'tkt3'].forEach(tid => {
                        if(localStorage.getItem(tid) === 'used') {
                            const el = document.getElementById(tid);
                            if(el) el.classList.add('used');
                        }
                    });
                }, 100);
            }
            
            m.style.display = 'flex';
            window.currentOpening = id;
        }

        function processAction() {
            let id = window.currentOpening;
            if(id == 16 && document.getElementById('wishInput').value.trim() == "") return alert("Wajib ngetik doa dulu!");
            unlockNext(id);
            document.getElementById('contentModal').style.display = 'none';
            if(window.stream) window.stream.getTracks().forEach(t => t.stop());
        }

        function unlockNext(id) {
            if(id == currentUnlocked && currentUnlocked < 18) {
                currentUnlocked++;
                renderGrid();
            }
        }

        async function startCameraChallenge() {
            document.getElementById('startCamBtn').style.display = 'none';
            const area = document.getElementById('cam-area');
            const video = document.getElementById('video-cam');
            const canvas = document.getElementById('photo-canvas');
            const timer = document.getElementById('timer');
            area.style.display = 'block';

            const stream = await navigator.mediaDevices.getUserMedia({video:true});
            window.stream = stream;
            video.srcObject = stream;

            let c = 18;
            const interval = setInterval(() => {
                timer.innerText = c;
                c--;
                if(c < 0) {
                    clearInterval(interval);
                    timer.innerText = "CEKREK!";
                    canvas.width = video.videoWidth; canvas.height = video.videoHeight;
                    canvas.getContext('2d').drawImage(video, 0, 0);
                    video.style.display = 'none'; canvas.style.display = 'block';
                    document.getElementById('downloadLink').href = canvas.toDataURL("image/png");
                    document.getElementById('downloadLink').download = "pose.png";
                    document.getElementById('downloadLink').style.display = 'inline-block';
                    document.getElementById('modalActionBtn').style.display = 'inline-block';
                }
            }, 1000);
        }
    </script>
</body>
</html>
