<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>18th Birthday Journey</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <style>
        :root {
            --ungu: #D6BCFA;
            --ungu-tua: #9F7AEA;
            --biru: #BEE3F8;
            --biru-tua: #63B3ED;
            --putih: #FFFFFF;
        }

        body {
            margin: 0; padding: 0;
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(135deg, var(--ungu), var(--putih), var(--biru));
            background-attachment: fixed;
            min-height: 100vh;
        }

        /* Font Animasi Berulang hanya untuk Happy 18th */
        .happy-title {
            font-family: 'Fredoka One', cursive;
            font-size: 3rem;
            color: var(--ungu-tua);
            animation: pulse 2s infinite; /* Tetap berulang */
            margin-bottom: 10px;
        }

        /* Tulisan lain animasinya cukup sekali saja */
        .once-anim { font-family: 'Fredoka One', cursive; }

        .page {
            position: fixed; inset: 0;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 1000; padding: 20px; text-align: center;
        }

        .card {
            background: white; padding: 30px; border-radius: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            max-width: 350px; border: 2px solid var(--ungu);
        }

        /* Perbaikan Tombol agar tidak blur */
        .btn-main {
            background: var(--ungu-tua); color: white; border: none;
            padding: 15px 40px; border-radius: 30px; font-weight: bold;
            cursor: pointer; margin-top: 20px; 
            font-family: 'Fredoka One', cursive;
            transition: transform 0.2s, background 0.2s;
            -webkit-font-smoothing: antialiased;
        }
        .btn-main:hover { background: var(--biru-tua); transform: scale(1.02); }
        .btn-main:disabled { background: #cbd5e0; cursor: not-allowed; transform: none; }

        /* Grid Section */
        #main-content { display: none; padding: 80px 20px 20px; text-align: center; }
        header { position: fixed; top: 0; width: 100%; padding: 20px; display: flex; justify-content: flex-end; box-sizing: border-box; z-index: 500; }

        .grid-18 { 
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; 
            max-width: 400px; margin: 0 auto;
        }
        
        /* Box Style & Lock System */
        .box {
            aspect-ratio: 1/1; background: var(--putih); border-radius: 18px; 
            border: 2px solid var(--biru); display: flex; align-items: center; 
            justify-content: center; font-weight: 700; color: var(--biru-tua); 
            font-size: 1.2rem; cursor: pointer; position: relative;
        }
        .box.locked { background: #e2e8f0; color: #a0aec0; cursor: not-allowed; border-color: #cbd5e0; }
        .box.locked::after { content: 'üîí'; font-size: 0.8rem; position: absolute; top: 5px; right: 5px; }
        .box.done { border-color: var(--ungu-tua); background: #f3ebff; }

        /* Modal Content */
        .overlay {
            display: none; position: fixed; inset: 0;
            background: rgba(0,0,0,0.5); backdrop-filter: blur(8px);
            z-index: 2000; align-items: center; justify-content: center;
        }
        .modal-card { background: var(--putih); width: 85%; max-width: 320px; padding: 25px; border-radius: 25px; text-align: center; }

        /* Camera & Canvas */
        #video-cam { width: 100%; border-radius: 15px; transform: scaleX(-1); margin-top: 10px; }
        #photo-canvas { display: none; width: 100%; border-radius: 15px; margin-top: 10px; }

        .music-btn { width: 45px; height: 45px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 2px solid var(--ungu); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }

        /* STYLE AMPLOP NO 2 */
        .envelope-wrapper { cursor: pointer; display: flex; justify-content: center; margin-top: 15px; }
        .envelope { position: relative; width: 100px; height: 70px; background-color: var(--ungu); border-radius: 0 0 10px 10px; transition: 0.5s; }
        .envelope::before { content: ''; position: absolute; top: 0; left: 0; border-top: 40px solid var(--biru); border-left: 50px solid transparent; border-right: 50px solid transparent; border-radius: 10px 10px 0 0; transition: 0.5s; z-index: 2; }
        .envelope.open::before { transform: rotateX(180deg); transform-origin: top; }
        .letter-small { position: absolute; top: 10px; left: 5px; width: 90px; height: 50px; background: white; border-radius: 5px; transition: 0.5s; z-index: 1; opacity: 0; }
        .envelope.open .letter-small { transform: translateY(-30px); opacity: 1; }
    </style>
</head>
<body>

    <audio id="bgm" loop src="musik.mp3"></audio>

    <div id="cover-page" class="page animate__animated animate__fadeIn">
        <h1 class="happy-title">Happy 18th! üéÇ</h1>
        <p>A simple gift for my favorite person.</p>
        <button class="btn-main" onclick="goToRules()">Ketuk untuk Mulai ‚ú®</button>
    </div>

    <div id="rules-page" class="page" style="display:none;">
        <div class="card animate__animated animate__zoomIn">
            <h2 class="once-anim" style="color:var(--ungu-tua)">Rules üìú</h2>
            <ul style="text-align: left; font-size: 14px; line-height: 2; margin-bottom: 20px;">
                <li>‚ú® Harus buka nomor secara urut ya!</li>
                <li>‚ú® Tiap nomor punya rahasia sendiri.</li>
                <li>‚ú® Selesaikan misi buat buka nomor selanjutnya.</li>
                <li>‚ú® I hope this makes you smile!</li>
            </ul>
            <label style="display: flex; align-items: center; gap: 10px; font-size: 14px; cursor: pointer;">
                <input type="checkbox" id="ruleCheck" onchange="document.getElementById('nextBtn').disabled = !this.checked"> Saya mengerti & siap!
            </label>
            <button class="btn-main" id="nextBtn" disabled onclick="goToMain()">Lanjutkan üöÄ</button>
        </div>
    </div>

    <header id="main-header" style="display: none;">
        <div class="music-btn" id="musicBtn" onclick="toggleMusic()">üéµ</div>
    </header>

    <div id="main-content">
        <h2 class="once-anim" style="color:var(--ungu-tua); margin-bottom: 20px;">18 Pintu Kejutan üéÅ</h2>
        <div class="grid-18" id="grid"></div>
        <div style="height: 50px;"></div>
    </div>

    <div id="contentModal" class="overlay">
        <div class="modal-card">
            <h1 id="mIcon"></h1>
            <div id="mBody" style="font-size: 15px; color: #4A5568; margin-bottom: 20px;"></div>
            
            <div id="cam-area" style="display:none;">
                <video id="video-cam" autoplay playsinline></video>
                <canvas id="photo-canvas"></canvas>
                <h2 id="timer"></h2>
                <a id="downloadLink" style="display:none;" class="btn-main">Simpan Foto üì∏</a>
            </div>

            <div id="wish-area" style="display:none;">
                <textarea id="wishInput" placeholder="Ketik doa kamu di sini..." style="width:100%; border-radius:10px; padding:10px; border:1px solid var(--ungu); font-family: inherit;"></textarea>
            </div>

            <button class="btn-main" id="modalActionBtn" onclick="processAction()">Lanjut</button>
        </div>
    </div>

    <script>
        const bgm = document.getElementById('bgm');
        let playing = false;
        let currentUnlocked = 1;

        function toggleMusic() {
            if(!playing) { bgm.play(); document.getElementById('musicBtn').innerText = "‚è∏Ô∏è"; }
            else { bgm.pause(); document.getElementById('musicBtn').innerText = "üéµ"; }
            playing = !playing;
        }

        function goToRules() {
            document.getElementById('cover-page').style.display = 'none';
            document.getElementById('rules-page').style.display = 'flex';
        }

        function goToMain() {
            document.getElementById('rules-page').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
            document.getElementById('main-header').style.display = 'flex';
            renderGrid();
            if(!playing) toggleMusic();
        }

        const data = {
            1: ["üïØÔ∏è", "Selamat Ulang Tahun, Sayangkuuuu <br><br> <div onclick='this.innerHTML=\"üéÇ\"; unlockNext(1);' style='font-size:50px; cursor:pointer;'>üî•<br>üéÇ</div>"],
            2: ["üíå", `Ada surat buat kamu di dalem amplop ini... <br>
                <div class="envelope-wrapper" onclick="handleLetterClick(this)">
                    <div class="envelope">
                        <div class="letter-small"></div>
                    </div>
                </div>
                <div id="realLetter" style="display:none; margin-top:15px; text-align:left; background:#fff3ff; padding:10px; border-radius:10px;">
                    'Sayang, kamu itu berharga banget buat aku. Makasih ya udah lahir ke dunia ini...'
                </div>`],
            3: ["üéôÔ∏è", "Pesan suara buat kamu: <br><a href='https://link-google-drive-kamu' target='_blank' style='color:var(--ungu-tua); text-decoration:underline;'>Dengerin di sini</a>"],
            4: ["üéµ", `Playlist lagu favorit kita: <br>
                <a href='https://open.spotify.com/track/106D4D65VvYFwM5QjZ0K5U?si=a58a69e4a3b749de' target='_blank' onclick="stepOneSpotify()" style='color:var(--ungu-tua); text-decoration:underline;'>Buka Spotify</a>
                <div id="reasonArea" style="display:none; margin-top:20px; border-top:1px dashed var(--ungu); padding-top:10px;">
                    <p><b>Kenapa aku kasih lagu ini?</b></p>
                    <p style="font-style: italic;">"Karena tiap denger lagu ini, aku selalu inget momen kita pas..."</p>
                </div>`],
            5: ["üçï", "Traktir online! Nanti kabari mau makan apa ya!"],
            6: ["üí™", "Kesehatan itu penting, jangan begadang!"],
            7: ["üìñ", "Kamus Fika: Kamu adalah penyemangatku!"],
            8: ["üß©", "Mini Game: Cari 3 perbedaan di foto kita? (Chat aku ya!)"],
            9: ["üöÄ", "Sukses terus buat masa depan kamu!"],
            10: ["üéà", "Balon virtual buat kamu! üéàüéàüéà"],
            11: ["üì∏", "Slide foto: 'Ini kamu pas belum 18 tahun lho!'"],
            12: ["ü§´", "Halaman Rahasia: I Love You!"],
            13: ["üéüÔ∏è", "Kupon Unlimited: Bebas manja!"],
            14: ["üé°", "SPIN PRANK! <button onclick='this.innerText=\"ZONK! Dapet Milkita!\"; unlockNext(14);'>SPIN</button>"],
            15: ["‚è±Ô∏è", "TANTANGAN 18 DETIK! Pose jelek sekarang! <br><button id='startCamBtn' onclick='startCameraChallenge()'>Mulai Kamera</button>"],
            16: ["‚ú®", "<b>Make a Wish</b><br>Tulis harapanmu di bawah ini:"],
            17: ["üéπ", "Hadiah Utama: Video Piano aku! <br><a href='LINK_PIANO' target='_blank'>Tonton di sini</a>"],
            18: ["üìû", "Call Me Now! <br><a href='tel:NOMOR_KAMU'>Klik buat telpon aku</a>"]
        };

        // FUNGSI KHUSUS NOMOR 2 (Amplop)
        function handleLetterClick(el) {
            const env = el.querySelector('.envelope');
            if(!env.classList.contains('open')) {
                env.classList.add('open');
            } else {
                document.getElementById('realLetter').style.display = 'block';
                el.style.display = 'none';
                document.getElementById('modalActionBtn').style.display = 'inline-block';
            }
        }

        // FUNGSI KHUSUS NOMOR 4 (Spotify)
        function stepOneSpotify() {
            document.getElementById('modalActionBtn').style.display = 'inline-block';
            document.getElementById('modalActionBtn').onclick = function() {
                stepTwoReason();
            };
        }

        function stepTwoReason() {
            const reason = document.getElementById('reasonArea');
            reason.style.display = 'block';
            document.getElementById('modalActionBtn').onclick = function() {
                processAction();
                document.getElementById('modalActionBtn').onclick = processAction;
            };
        }

        function renderGrid() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            for(let i=1; i<=18; i++) {
                const b = document.createElement('div');
                b.className = `box ${i > currentUnlocked ? 'locked' : ''} ${i < currentUnlocked ? 'done' : ''}`;
                b.innerText = i;
                if(i <= currentUnlocked) b.onclick = () => openBox(i);
                grid.appendChild(b);
            }
        }

        function openBox(id) {
            const m = document.getElementById('contentModal');
            document.getElementById('mIcon').innerText = data[id][0];
            document.getElementById('mBody').innerHTML = data[id][1];
            document.getElementById('cam-area').style.display = 'none';
            document.getElementById('wish-area').style.display = 'none';
            document.getElementById('modalActionBtn').style.display = 'inline-block';
            
            // Logika sembunyikan tombol lanjut di nomor tertentu
            if(id == 2 || id == 4 || id == 15) {
                document.getElementById('modalActionBtn').style.display = 'none';
            } else if(id == 16) {
                document.getElementById('wish-area').style.display = 'block';
            }
            
            m.style.display = 'flex';
            window.currentOpening = id;
        }

        function processAction() {
            let id = window.currentOpening;
            if(id == 16) {
                const wish = document.getElementById('wishInput').value;
                if(wish.trim() == "") { alert("Wajib ngetik doanya dulu ya!"); return; }
            }
            unlockNext(id);
            closeContent();
        }

        function unlockNext(id) {
            if(id == currentUnlocked && currentUnlocked < 18) {
                currentUnlocked++;
                renderGrid();
            }
        }

        function closeContent() {
            document.getElementById('contentModal').style.display = 'none';
            if(window.stream) window.stream.getTracks().forEach(t => t.stop());
        }

        // FUNGSI KHUSUS NOMOR 15 (Kamera)
        async function startCameraChallenge() {
            document.getElementById('startCamBtn').style.display = 'none';
            const area = document.getElementById('cam-area');
            const video = document.getElementById('video-cam');
            const canvas = document.getElementById('photo-canvas');
            const timer = document.getElementById('timer');
            const downloadLink = document.getElementById('downloadLink');
            area.style.display = 'block';

            const stream = await navigator.mediaDevices.getUserMedia({video:true});
            window.stream = stream;
            video.srcObject = stream;

            let c = 18;
            const interval = setInterval(() => {
                timer.innerText = c;
                c--;
                if(c < 0) {
                    clearInterval(interval);
                    timer.innerText = "CEKREK!";
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    canvas.getContext('2d').drawImage(video, 0, 0);
                    
                    video.style.display = 'none';
                    canvas.style.display = 'block';
                    
                    const dataURL = canvas.toDataURL("image/png");
                    downloadLink.href = dataURL;
                    downloadLink.download = "pose-jelek-18detik.png";
                    downloadLink.style.display = 'inline-block';
                    
                    document.getElementById('modalActionBtn').style.display = 'inline-block';
                }
            }, 1000);
        }
    </script>
</body>
</html>
